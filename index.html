<!doctype html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
            name="viewport">
      <meta content="ie=edge" http-equiv="X-UA-Compatible">
      <title>Space Invaders</title>
      <link href="assets/img/icons/sI-16.ico" rel="icon" type="image/x-icon">
      <link href="assets/css/mainStyles.css" rel="stylesheet">
      <link href="assets/css/animationsStyles.css" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
      <script type="module" src="assets/js/entities/Player.js"></script>
<!--      <script type="module" src="assets/js/entities/Octopus.js"></script>-->
      <script type="module" src="assets/js/entities/OctopusPool.js"></script>
      <script type="module" src="assets/js/game/Game.js"></script>
  </head>
  <body>
        <div class="main-container">
            <div class="left-container">
                <div class="score-container">
                    <div class="title-container">
                        <p>Nivel: </p>
                        <p id="level">1</p>
                    </div>
                    <div class="title-container">
                        <p>Score: </p>
                        <p id="score">0</p>
                    </div>
                    <div class="title-container">
                        <p>High Score: </p>
                        <p id="high-score">0</p>
                    </div>
                </div>
            </div>
            <div class="game-container">
                <div class="invader-container">
                    <div class="invaders-container"></div>
                    <div class="invaders-container"></div>
                    <div class="invaders-container"></div>
                </div>
                <div class="fortification-container">
                    <div class="shells-container">
                        <div class="shell" id="shell-1"></div>
                        <div class="shell" id="shell-2"></div>
                        <div class="shell" id="shell-3"></div>
                        <div class="shell" id="shell-4"></div>
                        <div class="shell" id="shell-5"></div>
                    </div>
                    <div class="player-container">
                        <div class="player" id="player">
                            <img src="assets/img/player.png" alt="player">
                        </div>
                    </div>
                </div>
            </div>
            <div class="right-container">
                <div class="instructions-container">

                </div>
            </div>
        </div>
        <div class="banner-container">
            <h1 id="text-1">
                <a href="https://github.com/naut54">
                    <img src="assets/img/icons/github-logo.svg" alt="github-logo">
                    <span>Visita mi GitHub</span>
                    <img src="assets/img/icons/github-logo.svg" alt="github-logo">
                </a>
            </h1>
        </div>
        <script type="module">
            import { OctopusPool } from './assets/js/entities/OctopusPool.js';
            import { Player } from './assets/js/entities/Player.js';

            document.addEventListener('DOMContentLoaded', () => {
                let currentLevel = 1;
                let activeOctopuses = 0;

                const octopusPool = new OctopusPool('.invaders-container', 4);

                const player = new Player();

                function startLevel(level) {
                    document.getElementById('level').textContent = level;
                    activeOctopuses = 0;

                    const containers = document.querySelectorAll('.invaders-container');

                    for (let containerIndex = 0; containerIndex < containers.length; containerIndex++) {
                        const container = containers[containerIndex];
                        const containerWidth = container.offsetWidth;
                        const spacing = containerWidth / 5;

                        for (let i = 0; i < 4; i++) {
                            const octopus = octopusPool.getOctopus(containerIndex);
                            if (octopus) {
                                octopus.activate(spacing * (i + 1), 30 + (40 * containerIndex));
                                octopus.velocity = 0.5 + (level * 0.1);
                                octopus.onDestroy = () => {
                                    activeOctopuses--;
                                    if (activeOctopuses <= 0) {
                                        setTimeout(() => {
                                            currentLevel++;
                                            startLevel(currentLevel);
                                        }, 1500);
                                    }
                                };
                                activeOctopuses++;
                            }
                        }
                    }
                }

                function gameLoop() {
                    const containers = document.querySelectorAll('.invaders-container');
                    for (let i = 0; i < containers.length; i++) {
                        const containerPool = octopusPool.pool[i] || [];
                        for (const octopus of containerPool) {
                            if (octopus.active) {
                                octopus.autoMove();
                            }
                        }
                    }

                    requestAnimationFrame(gameLoop);
                }

                startLevel(currentLevel);
                gameLoop();
            });
        </script>

  </body>
</html>